<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚²ãƒ¼ãƒ </title>
  <!-- ãƒ•ã‚¡ãƒ“ã‚³ãƒ³è¨­å®š -->
  <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">
  <link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon">
  <!-- TailwindCSSè¿½åŠ  -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- ãƒ•ã‚©ãƒ³ãƒˆè¿½åŠ  -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Zen Maru Gothic', 'Baloo 2', 'Meiryo', sans-serif;
    }
    /* è½ä¸‹å˜èªãƒ»çµæœè¡¨ç¤ºã«ä½¿ã†ãƒ•ã‚©ãƒ³ãƒˆ */
    .word,
    #wordText,
    #hitPercentText,
    #scoreText {
      font-family: 'Zen Maru Gothic', 'Baloo 2', 'Meiryo', sans-serif;
      font-weight: 700;
    }

    /* ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’è¦‹ã‚„ã™ãã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ« */
    #scoreText {
      background: rgba(255, 255, 255, 0.7);
      color: red;
      padding: 0.3em 0.8em;
      border-radius: 0.5em;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      display: inline-block;
    }

    /* ä¸‹1/3ã®ä½ç½®ã«é…ç½®ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ */
    .bottom-third {
      position: absolute;
      bottom: 25%;
      left: 50%;
      transform: translateX(-50%) translateY(50%);
      text-align: center;
      width: 100%;
    }
  </style>
</head>
<body class="bg-gray-200 relative min-h-screen w-screen bg-[url('image/many_kabab5_cut.png')] bg-center bg-cover">

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="bg-amber-300/80 w-full shadow-md p-1 sticky top-0 z-20">
    <h1 class="text-center text-lg font-bold m-2">ğŸ¥™ ã‚²ãƒ¼ãƒ çµæœ ğŸ¥™</h1>
  </header>

  <!-- èƒŒæ™¯ç”»åƒã¨ä¸­å¤®ãƒ†ã‚­ã‚¹ãƒˆ -->
  <main class="flex justify-center items-center min-h-[calc(100vh-100px)] relative z-10 px-4">
    <div class="relative w-full max-w-[90vw] max-h-[90vh] p-4">
      <!-- æ­£æ–¹å½¢ã‚³ãƒ³ãƒ†ãƒŠ -->
      <div class="relative bg-gray-100 rounded-lg shadow-lg flex justify-center items-center overflow-hidden mx-auto" id="resultContainer">
        <img id="resultImg" src="" alt="" class="w-full h-full object-contain" />

        <!-- ä¸‹1/3ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ†ã‚­ã‚¹ãƒˆç¾¤ -->
        <div class="bottom-third flex flex-col justify-center items-center px-2">
          <span id="wordText" class="font-bold text-white drop-shadow-lg text-center"></span>
          <span id="scoreText" class="font-bold text-white drop-shadow-lg mt-2 text-center text-xl"></span>
          <span id="hitPercentText" class="font-semibold text-white drop-shadow-lg mt-1 text-center"></span>
        </div>
      </div>
    </div>
  </main>

  <!-- å›ºå®šãƒœã‚¿ãƒ³ç¾¤ï¼ˆå…±é€šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæº–æ‹ ï¼‰ -->
  <div
    class="fixed bottom-20 left-1/2 transform -translate-x-1/2 
          grid justify-center gap-3 z-30
          sm:flex sm:flex-nowrap sm:justify-center"
    style="grid-template-columns: repeat(2, max-content);"
  >
    <!-- ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
    <button
      class="px-6 py-2 bg-blue-500/80 text-white font-semibold rounded-lg shadow-lg 
            hover:bg-blue-600/80 transition duration-200 backdrop-blur-sm
            w-auto min-w-fit"
      onclick="location.href='index.html'"
    >
      ãƒ›ãƒ¼ãƒ 
    </button>

    <!-- ã‚²ãƒ¼ãƒ å†æŒ‘æˆ¦ãƒœã‚¿ãƒ³ -->
    <button
      class="px-6 py-2 bg-red-500/80 text-white font-semibold rounded-lg shadow-lg 
            hover:bg-red-600/80 transition duration-200 backdrop-blur-sm
            w-auto min-w-fit"
      onclick="location.href='game.html'"
    >
      ã‚²ãƒ¼ãƒ å†æŒ‘æˆ¦
    </button>

    <!-- çµæœã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ -->
    <button
      class="px-6 py-2 bg-green-500/80 text-white font-semibold rounded-lg shadow-lg 
            hover:bg-green-600/80 transition duration-200 backdrop-blur-sm
            w-auto min-w-fit"
      id="shareButton"
    >
      çµæœã‚’ã‚·ã‚§ã‚¢
    </button>
  </div>

  <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
  <footer class="bg-amber-300/80 w-full shadow-inner p-1 fixed bottom-0 z-20">
    <p class="text-center m-1 text-sm sm:text-base">kabab-case-game@NOA</p>
  </footer>

  <script>
    const resultContainer = document.getElementById('resultContainer');
    const resultImg = document.getElementById("resultImg");
    const wordText = document.getElementById("wordText");
    const hitPercentText = document.getElementById("hitPercentText");
    const scoreText = document.getElementById("scoreText");

    // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
    const params = new URLSearchParams(window.location.search);
    const word = params.get("word") || "ä¸æ˜";
    const hitPercent = parseFloat(params.get("hitPercent")) || 0;

    // === èƒŒæ™¯ç”»åƒãƒ‘ã‚¿ãƒ¼ãƒ³ ===
    const patterns = [
      { regex: /^[a-z][A-Z][a-z0-9]+([A-Z][a-z0-9]*)*$/, img: "image/hungarian.png", label: "ãƒãƒ³ã‚¬ãƒªã‚¢ãƒ³è¨˜æ³•" },
      { regex: /^[a-z]+([A-Z][a-z0-9]*)+$/, img: "image/camel.png", label: "ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹" },
      { regex: /^[A-Z][a-z0-9]+([A-Z][a-z0-9]*)+$/, img: "image/upper_camel.png", label: "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹" },
      { regex: /^[a-z0-9]+(_[a-z0-9]+)+$/, img: "image/snake.png", label: "ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹" },
      { regex: /^[A-Z0-9]+(_[A-Z0-9]+)+$/, img: "image/upper_snake.png", label: "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹" },
      { regex: /^[a-z0-9]+( [a-z0-9]+)+$/, img: "image/kabab.png", label: "ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹" },
      { regex: /^[A-Z][a-z0-9]+( [A-Z][a-z0-9]+)+$/, img: "image/upper_kabab.png", label: "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹" },
      { regex: /^[a-z0-9]+(\.[a-z0-9]+)+$/, img: "image/dot.png", label: "ãƒ‰ãƒƒãƒˆè¨˜æ³•" },
    ];

    // === èƒŒæ™¯ç”»åƒè¡¨ç¤º ===
    let matched = patterns.find(p => p.regex.test(word)) || { img: "image/default.png", label: "ä¸æ˜" };
    resultImg.src = matched.img;
    resultImg.alt = matched.label;

    // === å˜èªè¡¨ç¤º ===
    wordText.textContent = word.replace(" ", "-");

    // === ã‚¹ã‚³ã‚¢ç®—å‡º ===
    function calcScore(hitPercent) {
      const diff = Math.abs(hitPercent - 50);
      let score = Math.max(0, Math.round(100 - diff * 2));
      return score;
    }

    // === ãƒ©ãƒ³ã‚¯ã¨æ¼”å‡º ===
    function getRank(score) {
      if (matched.label == "ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹" || matched.label == "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹") {
        if (score >= 100) return { label: "Perfect!", color: "text-orange-300" };
        if (score >= 90) return { label: "Great!", color: "text-yellow-300" };
        if (score >= 75) return { label: "Good!", color: "text-green-300" };
        if (score >= 50) return { label: "OK!", color: "text-blue-300" };
        return { label: "Miss...", color: "text-red-400" };
      } else {
        return { label: matched.label + "ã‚’åˆºã—ãŸï¼", color: "text-red-400" };
      };
    }

    const score = calcScore(hitPercent);
    const rank = getRank(score);

    // === ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ï¼ã‚¢ãƒƒãƒ‘ãƒ¼ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã®èƒŒæ™¯åˆ‡ã‚Šæ›¿ãˆ ===
    if (matched.label == "ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹" || matched.label == "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹") {
      if (hitPercent >= 85) {
        // ãƒ˜ãƒ“ã«å¤‰æ›´ï¼ˆã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹ç”»åƒï¼‰
        resultImg.src = "image/kabab_snake.png";
      } else {
        // ã‚¹ã‚³ã‚¢ã«å¿œã˜ãŸèƒŒæ™¯åˆ‡æ›¿
        if (score >= 100) resultImg.src = "image/perfect_kabab.png";
        else if (score >= 90) resultImg.src = "image/great_kabab.png";
        else if (score >= 75) resultImg.src = "image/good_kabab.png";
        else if (score >= 50) resultImg.src = "image/ok_kabab.png";
        else resultImg.src = "image/miss_kabab.png";
      }
    }

    // === ã‚¹ã‚³ã‚¢ã¨ãƒ©ãƒ³ã‚¯ã‚’è¡¨ç¤º ===
    if (matched.label == "ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹" || matched.label == "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹") {
      if (hitPercent >= 85) {
        scoreText.textContent = `ä¸‹ã‹ã‚‰ ${Math.round(100-hitPercent)}% åœ°ç‚¹ã«åˆºã•ã£ãŸï¼`;
      } else {
        scoreText.textContent = `${rank.label}ã€€${score}ç‚¹`;
      }
    } else {
      scoreText.textContent = `${rank.label}`;
    }
    scoreText.className = `font-bold ${rank.color} mt-2 text-center text-xl animate-pulse`;

    // Perfectæ™‚ã¯ç”»åƒã‚’å…‰ã‚‰ã›ã‚‹
    if (score >= 90) {
      resultImg.style.filter = "drop-shadow(0 0 20px rgba(255, 215, 0, 1))";
    }

    // === ãƒªã‚µã‚¤ã‚ºå¯¾å¿œ ===
    function resizeContainer() {
      const padding = 32;
      const maxWidth = window.innerWidth * 0.8 - padding;
      const maxHeight = (window.innerHeight - 100) * 0.9 - padding;
      const size = Math.min(maxWidth, maxHeight);
      resultContainer.style.width = `${size}px`;
      resultContainer.style.height = `${size}px`;

      // ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºèª¿æ•´
      let wordFontSize = Math.max(16, size * 0.06);
      wordText.style.fontSize = `${wordFontSize}px`;

      let scoreFontSize = Math.max(18, size * 0.045);
      scoreText.style.fontSize = `${scoreFontSize}px`;

      let hitFontSize = Math.max(12, size * 0.03);
      hitPercentText.style.fontSize = `${hitFontSize}px`;
    }

    window.addEventListener('resize', resizeContainer);
    window.addEventListener('load', resizeContainer);

    // === Xã‚·ã‚§ã‚¢æ©Ÿèƒ½ ===
    const shareButton = document.getElementById("shareButton");

    shareButton.addEventListener("click", () => {
      const baseUrl = "https://twitter.com/intent/tweet";

      // è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢
      const gameTitle = "ğŸ¥™ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚²ãƒ¼ãƒ ğŸ¥™";
      const wordDisplay = word.replace("-"," ");
      const scoreDisplay = `${score}ç‚¹`;
      const rankDisplay = rank.label;
      const caseType = matched.label;
      const pageUrl = window.location.origin + "/game.html"; // å…¬é–‹ãƒšãƒ¼ã‚¸URLã«å¤‰æ›´

      // æŠ•ç¨¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      const text = 
        `${gameTitle} \n` +
        `ã€Œ${wordDisplay}ã€ã«ä¸²ã‚’åˆºã—ãŸï¼\n` +
        `ä»•ä¸ŠãŒã‚Š: ${caseType}\n` +
        `è©•ä¾¡: ${rankDisplay}\n` +
        `ã‚¹ã‚³ã‚¢: ${scoreDisplay}\n\n` +
        `#ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚²ãƒ¼ãƒ \n`;

      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–
      const tweetUrl = `${baseUrl}?text=${encodeURIComponent(text)}&url=${encodeURIComponent(pageUrl)}`;

      // æ–°ã—ã„ã‚¿ãƒ–ã§XæŠ•ç¨¿ç”»é¢ã‚’é–‹ã
      window.open(tweetUrl, "_blank");
    });
  </script>

</body>
</html>