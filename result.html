<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚²ãƒ¼ãƒ </title>

  <!-- =========================
        ãƒ•ã‚¡ãƒ“ã‚³ãƒ³è¨­å®š
  ========================== -->
  <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon" />
  <link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon" />

  <!-- ==============================
       Tailwind CSS èª­ã¿è¾¼ã¿
  =============================== -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ==============================
       ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
  =============================== -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;600;700&family=Zen+Maru+Gothic:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- =========================
        ã‚¹ã‚¿ã‚¤ãƒ«å®šç¾©
  ========================== -->
  <style>
    /* å…±é€šãƒ•ã‚©ãƒ³ãƒˆè¨­å®š */
    body {
      font-family: 'M PLUS Rounded 1c','Zen Maru Gothic', 'Meiryo', sans-serif;
    }

    /* è½ä¸‹å˜èªãƒ»çµæœè¡¨ç¤ºç”¨ãƒ•ã‚©ãƒ³ãƒˆ */
    .word,
    #wordText,
    #hitPercentText,
    #scoreText {
      font-family: 'M PLUS Rounded 1c','Zen Maru Gothic', 'Meiryo', sans-serif;
      font-weight: 700;
    }

    /* ã‚¹ã‚³ã‚¢è¡¨ç¤ºãƒ‡ã‚¶ã‚¤ãƒ³ */
    #scoreText {
      background: rgba(255, 255, 255, 0.7);
      color: red;
      padding: 0.3em 0.8em;
      border-radius: 0.5em;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      display: inline-block;
    }

    /* ä¸‹1/3ã«é…ç½® */
    .bottom-third {
      position: absolute;
      bottom: 25%;
      left: 50%;
      transform: translateX(-50%) translateY(50%);
      text-align: center;
      width: 100%;
    }
  </style>
</head>

<body class="bg-gray-200 relative min-h-screen w-screen bg-[url('image/many_kabab5_cut.png')] bg-center bg-cover">

  <!-- =========================
        ãƒ˜ãƒƒãƒ€ãƒ¼
  ========================== -->
  <header class="bg-amber-300/80 w-full shadow-md p-1 sticky top-0 z-20">
    <h1 class="text-center text-lg font-bold m-2">ğŸ¥™ ã‚²ãƒ¼ãƒ çµæœ ğŸ¥™</h1>
  </header>

  <!-- =========================
        ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆçµæœè¡¨ç¤ºï¼‰
  ========================== -->
  <main class="flex justify-center items-center min-h-[calc(100vh-100px)] relative z-10 px-4">
    <div class="relative w-full max-w-[90vw] max-h-[90vh] p-4">

      <!-- çµæœã‚³ãƒ³ãƒ†ãƒŠï¼ˆæ­£æ–¹å½¢ï¼‰ -->
      <div id="resultContainer" class="relative bg-gray-100 rounded-lg shadow-lg flex justify-center items-center overflow-hidden mx-auto">
        <img id="resultImg" src="" alt="" class="w-full h-full object-contain" />

        <!-- ä¸‹éƒ¨ãƒ†ã‚­ã‚¹ãƒˆç¾¤ -->
        <div class="bottom-third flex flex-col justify-center items-center px-2">
          <span id="wordText" class="font-bold text-white drop-shadow-lg text-center"></span>
          <span id="scoreText" class="font-bold text-white drop-shadow-lg mt-2 text-center text-xl"></span>
          <span id="hitPercentText" class="font-semibold text-white drop-shadow-lg mt-1 text-center"></span>
        </div>
      </div>

    </div>
  </main>

  <!-- =========================
        å›ºå®šãƒœã‚¿ãƒ³ç¾¤ï¼ˆå…±é€šãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰
  ========================== -->
  <div
    class="fixed bottom-20 left-1/2 transform -translate-x-1/2 
           grid justify-center gap-3 z-30
           sm:flex sm:flex-nowrap sm:justify-center"
    style="grid-template-columns: repeat(2, max-content);"
  >
    <!-- ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
    <button
      onclick="location.href='index.html'"
      class="px-6 py-2 bg-blue-500/80 text-white font-semibold rounded-lg shadow-lg 
             hover:bg-blue-600/80 transition duration-200 backdrop-blur-sm
             w-auto min-w-fit"
    >
      ãƒ›ãƒ¼ãƒ 
    </button>

    <!-- ã‚²ãƒ¼ãƒ å†æŒ‘æˆ¦ãƒœã‚¿ãƒ³ -->
    <button
      onclick="location.href='game.html'"
      class="px-6 py-2 bg-red-500/80 text-white font-semibold rounded-lg shadow-lg 
             hover:bg-red-600/80 transition duration-200 backdrop-blur-sm
             w-auto min-w-fit"
    >
      ã‚²ãƒ¼ãƒ å†æŒ‘æˆ¦
    </button>

    <!-- çµæœã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ -->
    <button
      id="shareButton"
      class="px-6 py-2 bg-green-500/80 text-white font-semibold rounded-lg shadow-lg 
             hover:bg-green-600/80 transition duration-200 backdrop-blur-sm
             w-auto min-w-fit"
    >
      çµæœã‚·ã‚§ã‚¢
    </button>
  </div>

  <!-- =========================
        ãƒ•ãƒƒã‚¿ãƒ¼
  ========================== -->
  <footer class="bg-amber-300/80 w-full shadow-inner p-1 fixed bottom-0 z-20">
    <p class="text-center m-1 text-sm sm:text-base">kabab-case-game@NOA</p>
  </footer>

  <!-- =========================
        ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
  ========================== -->
  <script>
    // === è¦ç´ å–å¾— ===
    const resultContainer = document.getElementById('resultContainer');
    const resultImg = document.getElementById("resultImg");
    const wordText = document.getElementById("wordText");
    const hitPercentText = document.getElementById("hitPercentText");
    const scoreText = document.getElementById("scoreText");

    // === URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾— ===
    const params = new URLSearchParams(window.location.search);
    const word = params.get("word") || "ä¸æ˜";
    const hitPercent = parseFloat(params.get("hitPercent")) || 0;

    // === ã‚±ãƒ¼ã‚¹åˆ¤å®šç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³ ===
    const patterns = [
      { regex: /^[a-z][A-Z][a-z0-9]+([A-Z][a-z0-9]*)*$/, img: "image/hungarian.png", label: "ãƒãƒ³ã‚¬ãƒªã‚¢ãƒ³è¨˜æ³•" },
      { regex: /^[a-z]+([A-Z][a-z0-9]*)+$/, img: "image/camel.png", label: "ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹" },
      { regex: /^[A-Z][a-z0-9]+([A-Z][a-z0-9]*)+$/, img: "image/upper_camel.png", label: "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã‚±ãƒ¼ã‚¹" },
      { regex: /^[a-z0-9]+(_[a-z0-9]+)+$/, img: "image/snake.png", label: "ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹" },
      { regex: /^[A-Z0-9]+(_[A-Z0-9]+)+$/, img: "image/upper_snake.png", label: "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚¹ãƒãƒ¼ã‚¯ã‚±ãƒ¼ã‚¹" },
      { regex: /^[a-z0-9]+( [a-z0-9]+)+$/, img: "image/kabab.png", label: "ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹" },
      { regex: /^[A-Z][a-z0-9]+( [A-Z][a-z0-9]+)+$/, img: "image/upper_kabab.png", label: "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹" },
      { regex: /^[a-z0-9]+(\.[a-z0-9]+)+$/, img: "image/dot.png", label: "ãƒ‰ãƒƒãƒˆè¨˜æ³•" },
    ];

    // === ãƒãƒƒãƒãƒ³ã‚°ã¨çµæœç”»åƒè¨­å®š ===
    const matched = patterns.find(p => p.regex.test(word)) || { img: "image/default.png", label: "ä¸æ˜" };
    resultImg.src = matched.img;
    resultImg.alt = matched.label;

    // === å˜èªè¡¨ç¤ºï¼ˆã‚±ãƒãƒ–ç”¨ã«ç½®æ›ï¼‰ ===
    wordText.textContent = word.replace(" ", "-");

    // === ã‚¹ã‚³ã‚¢ç®—å‡ºé–¢æ•° ===
    const calcScore = hitPercent => {
      const diff = Math.abs(hitPercent - 50);
      return Math.max(0, Math.round(100 - diff * 2));
    };

    // === ãƒ©ãƒ³ã‚¯åˆ¤å®šé–¢æ•° ===
    const getRank = score => {
      if (["ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹", "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹"].includes(matched.label)) {
        if (score >= 100) return { label: "Perfect!", color: "text-orange-300" };
        if (score >= 90)  return { label: "Great!", color: "text-yellow-300" };
        if (score >= 75)  return { label: "Good!", color: "text-green-300" };
        if (score >= 50)  return { label: "OK!", color: "text-blue-300" };
        return { label: "Miss...", color: "text-red-400" };
      } else {
        return { label: matched.label + "ã‚’åˆºã—ãŸï¼", color: "text-red-400" };
      }
    };

    // === ã‚¹ã‚³ã‚¢ãƒ»ãƒ©ãƒ³ã‚¯åˆ¤å®š ===
    const score = calcScore(hitPercent);
    const rank = getRank(score);

    // === ã‚±ãƒãƒ–å°‚ç”¨ç”»åƒåˆ†å² ===
    if (["ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹", "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹"].includes(matched.label)) {
      if (hitPercent >= 85) {
        resultImg.src = "image/kabab_snake.png";
      } else {
        if (score >= 100) resultImg.src = "image/perfect_kabab.png";
        else if (score >= 90) resultImg.src = "image/great_kabab.png";
        else if (score >= 75) resultImg.src = "image/good_kabab.png";
        else if (score >= 50) resultImg.src = "image/ok_kabab.png";
        else resultImg.src = "image/miss_kabab.png";
      }
    }

    // === ã‚¹ã‚³ã‚¢ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š ===
    if (["ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹", "ã‚¢ãƒƒãƒ‘ãƒ¼ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹"].includes(matched.label)) {
      scoreText.textContent =
        hitPercent >= 85
          ? `ä¸‹ã‹ã‚‰ ${Math.round(100 - hitPercent)}% åœ°ç‚¹ã«åˆºã•ã£ãŸï¼`
          : `${rank.label}ã€€${score}ç‚¹`;
    } else {
      scoreText.textContent = rank.label;
    }
    scoreText.className = `font-bold ${rank.color} mt-2 text-center text-xl animate-pulse`;

    // === é«˜ã‚¹ã‚³ã‚¢æ™‚ã®å…‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ ===
    if (score >= 90) {
      resultImg.style.filter = "drop-shadow(0 0 20px rgba(255, 215, 0, 1))";
    }

    // === ãƒªã‚µã‚¤ã‚ºå‡¦ç† ===
    const resizeContainer = () => {
      const padding = 32;
      const maxWidth = window.innerWidth * 0.8 - padding;
      const maxHeight = (window.innerHeight - 100) * 0.9 - padding;
      const size = Math.min(maxWidth, maxHeight);

      resultContainer.style.width = `${size}px`;
      resultContainer.style.height = `${size}px`;

      wordText.style.fontSize = `${Math.max(16, size * 0.06)}px`;
      scoreText.style.fontSize = `${Math.max(18, size * 0.045)}px`;
      hitPercentText.style.fontSize = `${Math.max(12, size * 0.03)}px`;
    };
    window.addEventListener('resize', resizeContainer);
    window.addEventListener('load', resizeContainer);

    // === Xï¼ˆæ—§Twitterï¼‰ã‚·ã‚§ã‚¢æ©Ÿèƒ½ ===
    document.getElementById("shareButton").addEventListener("click", () => {
      const baseUrl = "https://twitter.com/intent/tweet";
      const gameTitle = "ğŸ¥™ã‚±ãƒãƒ–-ã‚±ãƒ¼ã‚¹-ã‚²ãƒ¼ãƒ ğŸ¥™";
      const wordDisplay = word.replace("-", " ");
      const text = `${gameTitle}\n-----------------------------\nç´ æã€Œ${wordDisplay}ã€ã«ä¸²ã‚’åˆºã—ãŸï¼\nğŸ¥™ä»•ä¸ŠãŒã‚Š: ${matched.label}\nğŸ¯è©•ä¾¡: ${rank.label}\nğŸ’¯ã‚¹ã‚³ã‚¢: ${score}ç‚¹\n-----------------------------\n#ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚²ãƒ¼ãƒ \n`;
      const pageUrl = window.location.origin + "/game.html";
      const tweetUrl = `${baseUrl}?text=${encodeURIComponent(text)}&url=${encodeURIComponent(pageUrl)}`;
      window.open(tweetUrl, "_blank");
    });
  </script>
</body>
</html>