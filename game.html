<!DOCTYPE html>
<html>
  <head>
    <title>ケバブケースゲーム</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .body{
      font-family:'メイリオ', 'Meiryo', 'Hiragino Kaku Gothic ProN', 'ヒラギノ角ゴ ProN W3', sans-serif;
    }
    body { overflow: hidden; }
    .word {
      position: absolute;
      font-size: 2rem;
      font-weight: bold;
    }
    #skewer {
      position: absolute;
      right: 50px;
      top: 50%;
      transform: translateY(-50%);
      transition: left 0.2s;
    }
  </style>
  </head>
    <body class="relative h-screen bg-gray-100 bg-[url('image/target_cut.png')] bg-no-repeat bg-center bg-fixed min-h-screen">
      <!-- ヘッダー -->
      <header class="bg-amber-300/80 w-full shadow-md p-1 sticky top-0">
        <h1 class="text-center text-lg m-2">ゲーム画面：落ちてくる言葉に串をさしてケバブケース作れ！</h1>
      </header>

      <!-- メインコンテンツ -->
      <main class="relative w-full" id="gameArea" style="height: calc(100vh - 60px - 60px); margin-top: 0px;">
        <!-- 串 -->
        <img id="skewer" src="image/skewer.png" alt="skewer" class="w-24 h-24">
        <!-- ボタン -->
        <button id="moveButton" class="fixed bottom-[70px] right-5 px-4 py-2 bg-blue-500 text-white rounded">串を刺す</button>
        <button id="backButton" class="fixed bottom-[70px] left-5 px-4 py-2 bg-blue-500 text-white rounded" onclick="location.href='index.html'">戻る</button>
      </main>
      
      <!-- フッター -->
      <footer class="bg-amber-300/80 w-full shadow-inner p-1 fixed bottom-0">
        <p class="text-center m-2">@NOA</p>
      </footer>

      <script>
      const words = ["apple ringo", "banana.test", "sakuraCherry", "date", "fig", "grape"]; // 落ちる単語
      const wordElements = [];
      const results = [];

      const gameArea = document.getElementById("gameArea");
      const skewer = document.getElementById("skewer");
      // let skewerLeft = parseInt(window.innerWidth - 100); // 初期位置
      let skewerLeft = gameArea.clientWidth - 100; // 初期位置（main幅に依存）

      // 単語生成
      function createWord() {
        const word = document.createElement("div");
        word.classList.add("word");
        word.textContent = words[Math.floor(Math.random() * words.length)];

        const leftMargin = 50;   
        const rightMargin = 220; 
        const maxLeft = gameArea.clientWidth - leftMargin - rightMargin - 50; // 50は単語幅想定
        word.style.left = leftMargin + Math.random() * maxLeft + "px";

        word.style.top = "0px";
        word.dataset.speed = 1 + Math.random() * 3;
        gameArea.appendChild(word);
        wordElements.push(word);
      }

      // 単語を落とす
      function updateWords() {
      wordElements.forEach((word, index) => {
        const speed = parseFloat(word.dataset.speed);
        word.style.top = parseFloat(word.style.top) + speed + "px";

        const wordRect = word.getBoundingClientRect();
        const skewerRect = skewer.getBoundingClientRect();

        // 衝突判定（右側から）
        if (
          wordRect.right > skewerRect.left &&
          wordRect.left < skewerRect.right &&
          wordRect.bottom > skewerRect.top &&
          wordRect.top < skewerRect.bottom
        ) {
          const wordText = word?.textContent || "";

          // 串が単語のどの高さに当たったかを計算
          const hitY = skewerRect.top;
          const positionPercent = ((hitY - wordRect.top) / wordRect.height) * 100;
          const hitPercent = Math.min(Math.max(positionPercent, 0), 100).toFixed(1);

          results.push({ word: wordText, hitPercent });
          console.log("衝突しました:", wordText, hitPercent);

          // 先にテキストを保存してから remove()
          word.remove();
          wordElements.splice(index, 1);

          // ページ遷移
          setTimeout(() => {
            window.location.href = `result.html?word=${encodeURIComponent(wordText)}&hitPercent=${hitPercent}`;
          }, 100);
        }

        // 画面下に到達したら削除
        if (parseFloat(word.style.top) > window.innerHeight) {
          word.remove();
          wordElements.splice(index, 1);
        }
      });
    }

      // 串移動
      let flying = false; // 飛行中フラグ
      skewer.style.left = skewerLeft + "px";

      // 串ボタン押下時
      document.getElementById("moveButton").addEventListener("click", () => {
        if (flying) return; // 既に飛んでいる間は無効
        flying = true;
        const speed = 40; // 1フレームあたりの移動量（px）

        function fly() {
          skewerLeft -= speed; // 左に30px移動
          skewer.style.left = skewerLeft + "px";

          if (skewerLeft + skewer.offsetWidth > 0) {
            requestAnimationFrame(fly); // 左端に到達するまで移動
          } else {
            // 完全に画面外に出たらリセット
            skewerLeft = gameArea.clientWidth - skewer.offsetWidth;
            skewer.style.left = skewerLeft + "px";
            flying = false;
          }
        }

        requestAnimationFrame(fly); // 押した瞬間に動かす
      });

      // ウィンドウリサイズ時に初期位置を更新
      window.addEventListener('resize', () => {
        if (!flying) {
          skewerLeft = gameArea.clientWidth - 100;
          skewer.style.left = skewerLeft + "px";
        }
      });

      // ゲームループ
      setInterval(() => {
        if (Math.random() < 0.03) createWord(); // ランダム生成
        updateWords();
      }, 16); // 60fps
      </script>

  </body>
</html>
