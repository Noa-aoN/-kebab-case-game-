<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ケバブケースゲーム</title>

  <!-- ===========================
        ファビコン設定
  ============================ -->
  <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">
  <link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon">

  <!-- ==============================
       Tailwind CSS 読み込み
  =============================== -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ==============================
       フォント設定
  =============================== -->
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- ===========================
        スタイル設定
  ============================ -->
  <style>
    body {
      font-family: 'M PLUS Rounded 1c','Zen Maru Gothic', 'Meiryo', sans-serif;
      overflow: hidden;
    }

    .word {
      position: absolute;
      font-weight: bold;
      user-select: none;
      font-family: 'Quicksand', 'M PLUS Rounded 1c', 'Zen Maru Gothic', 'Meiryo', sans-serif;
    }

    /* スマホ用（画面幅640px以下） */
    @media screen and (max-width: 640px) {
      .word {
        font-size: 1.5rem !important;
      }
      /* ボタン全体を少し下に移動 */
      .fixed.bottom-20 {
        bottom: 3rem !important; /* ← 通常は5rem相当、ここでは約6.4remに下げる */
      }
    }

    /* 串のスタイル */
    #skewer {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      max-width: 150px;
      max-height: 150px;
      object-fit: contain;
      animation: kababRedGlow 2s linear infinite;
      transition: filter 0.3s ease;
    }

    /* 赤く光るアニメーション */
    @keyframes kababRedGlow {
      0% {
        filter: drop-shadow(0 0 6px rgba(255, 80, 80, 0.9))
                drop-shadow(0 0 12px rgba(255, 60, 60, 0.8))
                drop-shadow(0 0 24px rgba(255, 40, 40, 0.7));
      }
      50% {
        filter: drop-shadow(0 0 10px rgba(255, 120, 120, 1))
                drop-shadow(0 0 20px rgba(255, 100, 100, 0.9))
                drop-shadow(0 0 40px rgba(255, 80, 80, 0.8));
      }
      100% {
        filter: drop-shadow(0 0 6px rgba(255, 80, 80, 0.9))
                drop-shadow(0 0 12px rgba(255, 60, 60, 0.8))
                drop-shadow(0 0 24px rgba(255, 40, 40, 0.7));
      }
    }
  </style>
</head>

<body class="relative h-screen bg-gray-100 bg-[url('image/target_cut2.png')] bg-center bg-cover">

  <!-- ===========================
        ヘッダー
  ============================ -->
  <header class="bg-amber-300/80 w-full shadow-md p-1 sticky top-0">
    <h1 class="text-center text-lg font-bold m-2">
      🥙 落下文字を見極めて串を飛ばし最高のケバブケースを作ろう 🥙
    </h1>
  </header>

  <!-- ===========================
        メインコンテンツ
  ============================ -->
  <main id="gameArea" class="relative w-full" style="height: calc(100vh - 60px - 60px);">

    <!-- 串画像 -->
    <img id="skewer" src="image/skewer_sm.png" alt="skewer">

    <!-- ===========================
          共通ボタン（中央固定）
    ============================ -->
    <div
      class="fixed bottom-20 left-1/2 transform -translate-x-1/2 
             grid justify-center gap-3 z-30
             sm:flex sm:flex-nowrap sm:justify-center"
      style="grid-template-columns: repeat(2, max-content);"
    >
      <!-- ホームボタン -->
      <button
        class="px-6 py-2 bg-blue-500/80 text-white font-semibold rounded-lg shadow-lg 
               hover:bg-blue-600/80 transition duration-200 backdrop-blur-sm
               w-auto min-w-fit"
        onclick="location.href='index.html'"
      >
        ホーム
      </button>

      <!-- 操作説明 -->
      <button
        class="px-6 py-2 bg-green-500/80 text-white font-semibold rounded-lg shadow-lg 
               hover:bg-green-600/80 transition duration-200 backdrop-blur-sm
               w-auto min-w-fit"
        onclick="location.href='rules.html'"
      >
        操作説明
      </button>

      <!-- 用語解説 -->
      <button
        class="px-6 py-2 bg-green-500/80 text-white font-semibold rounded-lg shadow-lg 
               hover:bg-green-600/80 transition duration-200 backdrop-blur-sm
               w-auto min-w-fit"
        onclick="location.href='glossary.html'"
      >
        用語解説
      </button>

      <!-- 串を飛ばすボタン -->
      <button
        id="moveButton"
        class="px-6 py-2 bg-red-500/80 text-white font-semibold rounded-lg shadow-lg 
               hover:bg-red-600/80 transition duration-200 backdrop-blur-sm
               w-auto min-w-fit"
      >
        串を飛ばす
      </button>
    </div>
  </main>

  <!-- ===========================
        フッター
  ============================ -->
  <footer class="bg-amber-300/80 w-full shadow-inner p-1 fixed bottom-0">
    <p class="text-center m-1 text-sm sm:text-base">kabab-case-game@NOA</p>
  </footer>

  <!-- ===========================
        スクリプト
  ============================ -->
  <script>
    // -------------------------------------
    // 定数・変数の初期設定
    // -------------------------------------
    const words = [
      // ケバブ素材
      "chicken meat", "cow meat", "sheep meat", "Turkey Meat", "Pita Bread",

      // スネーク系（snake_case）
      "anaconda_serpent",

      // アッパースネーク系（UPPER_SNAKE_CASE）
      "ANACONDA_SERPENT",

      // キャメル系（lowerCamelCase）
      "dromedaryCamel",

      // アッパーキャメル系（PascalCase）
      "BactrianCamel",

      // ハンガリアン記法
      "pListData", "iCount",

      // ドット記法
      "polka.dot", "pin.dot",
    ];

    const wordElements = [];
    const results = [];

    const gameArea = document.getElementById("gameArea");
    const skewer = document.getElementById("skewer");

    let skewerLeft = 0;
    let flying = false;

    // -------------------------------------
    // 串の初期位置設定（右端に配置）
    // -------------------------------------
    function setSkewerInitialPosition() {
      const skewerWidth = skewer.offsetWidth || 150;
      skewerLeft = window.innerWidth - skewerWidth;
      skewer.style.left = skewerLeft + "px";
      skewer.style.display = "block";
    }

    setSkewerInitialPosition();

    // -------------------------------------
    // 単語生成（ランダムサイズ・速度・位置）
    // -------------------------------------
    function createWord() {
      const word = document.createElement("div");
      word.classList.add("word");
      word.textContent = words[Math.floor(Math.random() * words.length)];

      // フォントサイズ（1.5〜2.5rem）
      const fontSize = 1.5 + Math.random();
      word.style.fontSize = fontSize + "rem";

      gameArea.appendChild(word);

      // ランダムな左右位置と落下速度
      const wordWidth = word.offsetWidth;
      const margin = 10;
      const minLeft = 10;
      const maxLeft = skewerLeft - wordWidth - margin;
      if (window.innerWidth <= 640) { // 少しスマホ対応
        word.style.left = minLeft + Math.random() * (maxLeft - minLeft) - 100 + "px";
      } else {
        word.style.left = minLeft + Math.random() * (maxLeft - minLeft) + "px";
      }
      word.style.top = "0px";
      word.dataset.speed = 0.5 + Math.random() * 1.5;

      wordElements.push(word);
    }

    // -------------------------------------
    // 衝突判定
    // -------------------------------------
    function hitCheckSkewer(skewerRect, wordRect) {
      const tolerance = 5;
      const skewerLeftX = skewerRect.left;
      const skewerRightX = skewerRect.right;
      const skewerCenterY = skewerRect.top + skewerRect.height / 2;

      const horizontalHit =
        skewerLeftX <= wordRect.right + tolerance &&
        skewerRightX >= wordRect.right - tolerance;

      const verticalHit =
        skewerCenterY >= wordRect.top &&
        skewerCenterY <= wordRect.bottom;

      return horizontalHit && verticalHit;
    }

    // -------------------------------------
    // 単語の落下・衝突検出
    // -------------------------------------
    function updateWords() {
      wordElements.forEach((word, index) => {
        const speed = parseFloat(word.dataset.speed);
        word.style.top = parseFloat(word.style.top) + speed + "px";

        const wordRect = word.getBoundingClientRect();
        const skewerRect = skewer.getBoundingClientRect();

        // 衝突時の処理
        if (hitCheckSkewer(skewerRect, wordRect)) {
          const wordText = word.textContent || "";
          const skewerCenterY = skewerRect.top + skewerRect.height / 2;
          const hitPercent = ((skewerCenterY - wordRect.top) / wordRect.height) * 100;
          const clampedHitPercent = Math.min(Math.max(hitPercent, 0), 100).toFixed(1);

          results.push({ word: wordText, hitPercent: clampedHitPercent });
          console.log("衝突しました:", wordText, clampedHitPercent);

          word.remove();
          wordElements.splice(index, 1);

          setTimeout(() => {
            window.location.href = `result.html?word=${encodeURIComponent(wordText)}&hitPercent=${clampedHitPercent}`;
          }, 100);
        }

        // 画面外に落下したら削除
        if (parseFloat(word.style.top) > window.innerHeight) {
          word.remove();
          wordElements.splice(index, 1);
        }
      });
    }

    // -------------------------------------
    // 串の移動処理
    // -------------------------------------
    document.getElementById("moveButton").addEventListener("click", () => {
      if (flying) return;
      flying = true;
      const speed = 40;

      function fly() {
        skewerLeft -= speed;
        if (skewerLeft < 0) skewerLeft = 0;
        skewer.style.left = skewerLeft + "px";

        if (skewerLeft > 0) {
          requestAnimationFrame(fly);
        } else {
          skewer.style.display = "none";
          setTimeout(() => {
            setSkewerInitialPosition();
            flying = false;
          }, 300);
        }
      }

      requestAnimationFrame(fly);
    });

    // -------------------------------------
    // ウィンドウサイズ変更時に串を再配置
    // -------------------------------------
    window.addEventListener('resize', () => {
      if (!flying) {
        setSkewerInitialPosition();
      }
    });

    // -------------------------------------
    // ゲームループ
    // -------------------------------------
    setInterval(() => {
      if (Math.random() < 0.03) createWord();
      updateWords();
    }, 16);
  </script>
</body>
</html>