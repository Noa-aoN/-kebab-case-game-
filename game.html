<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚²ãƒ¼ãƒ </title>

  <!-- ===========================
        ãƒ•ã‚¡ãƒ“ã‚³ãƒ³è¨­å®š
  ============================ -->
  <link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">
  <link rel="icon" href="favicon.ico" type="image/vnd.microsoft.icon">

  <!-- ==============================
       Tailwind CSS èª­ã¿è¾¼ã¿
  =============================== -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ==============================
       ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
  =============================== -->
  <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- ===========================
        ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
  ============================ -->
  <style>
    body {
      font-family: 'M PLUS Rounded 1c','Zen Maru Gothic', 'Meiryo', sans-serif;
      overflow: hidden;
    }

    .word {
      position: absolute;
      font-weight: bold;
      user-select: none;
      font-family: 'Quicksand', 'M PLUS Rounded 1c', 'Zen Maru Gothic', 'Meiryo', sans-serif;
    }

    /* ã‚¹ãƒãƒ›ç”¨ï¼ˆç”»é¢å¹…640pxä»¥ä¸‹ï¼‰ */
    @media screen and (max-width: 640px) {
      .word {
        font-size: 1.5rem !important;
      }
      /* ãƒœã‚¿ãƒ³å…¨ä½“ã‚’å°‘ã—ä¸‹ã«ç§»å‹• */
      .fixed.bottom-20 {
        bottom: 3rem !important; /* â† é€šå¸¸ã¯5remç›¸å½“ã€ã“ã“ã§ã¯ç´„6.4remã«ä¸‹ã’ã‚‹ */
      }
    }

    /* ä¸²ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    #skewer {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      max-width: 150px;
      max-height: 150px;
      object-fit: contain;
      animation: kababRedGlow 2s linear infinite;
      transition: filter 0.3s ease;
    }

    /* èµ¤ãå…‰ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    @keyframes kababRedGlow {
      0% {
        filter: drop-shadow(0 0 6px rgba(255, 80, 80, 0.9))
                drop-shadow(0 0 12px rgba(255, 60, 60, 0.8))
                drop-shadow(0 0 24px rgba(255, 40, 40, 0.7));
      }
      50% {
        filter: drop-shadow(0 0 10px rgba(255, 120, 120, 1))
                drop-shadow(0 0 20px rgba(255, 100, 100, 0.9))
                drop-shadow(0 0 40px rgba(255, 80, 80, 0.8));
      }
      100% {
        filter: drop-shadow(0 0 6px rgba(255, 80, 80, 0.9))
                drop-shadow(0 0 12px rgba(255, 60, 60, 0.8))
                drop-shadow(0 0 24px rgba(255, 40, 40, 0.7));
      }
    }
  </style>
</head>

<body class="relative h-screen bg-gray-100 bg-[url('image/target_cut2.png')] bg-center bg-cover">

  <!-- ===========================
        ãƒ˜ãƒƒãƒ€ãƒ¼
  ============================ -->
  <header class="bg-amber-300/80 w-full shadow-md p-1 sticky top-0">
    <h1 class="text-center text-lg font-bold m-2">
      ğŸ¥™ è½ä¸‹æ–‡å­—ã‚’è¦‹æ¥µã‚ã¦ä¸²ã‚’é£›ã°ã—æœ€é«˜ã®ã‚±ãƒãƒ–ã‚±ãƒ¼ã‚¹ã‚’ä½œã‚ã† ğŸ¥™
    </h1>
  </header>

  <!-- ===========================
        ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  ============================ -->
  <main id="gameArea" class="relative w-full" style="height: calc(100vh - 60px - 60px);">

    <!-- ä¸²ç”»åƒ -->
    <img id="skewer" src="image/skewer_sm.png" alt="skewer">

    <!-- ===========================
          å…±é€šãƒœã‚¿ãƒ³ï¼ˆä¸­å¤®å›ºå®šï¼‰
    ============================ -->
    <div
      class="fixed bottom-20 left-1/2 transform -translate-x-1/2 
             grid justify-center gap-3 z-30
             sm:flex sm:flex-nowrap sm:justify-center"
      style="grid-template-columns: repeat(2, max-content);"
    >
      <!-- ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ -->
      <button
        class="px-6 py-2 bg-blue-500/80 text-white font-semibold rounded-lg shadow-lg 
               hover:bg-blue-600/80 transition duration-200 backdrop-blur-sm
               w-auto min-w-fit"
        onclick="location.href='index.html'"
      >
        ãƒ›ãƒ¼ãƒ 
      </button>

      <!-- æ“ä½œèª¬æ˜ -->
      <button
        class="px-6 py-2 bg-green-500/80 text-white font-semibold rounded-lg shadow-lg 
               hover:bg-green-600/80 transition duration-200 backdrop-blur-sm
               w-auto min-w-fit"
        onclick="location.href='rules.html'"
      >
        æ“ä½œèª¬æ˜
      </button>

      <!-- ç”¨èªè§£èª¬ -->
      <button
        class="px-6 py-2 bg-green-500/80 text-white font-semibold rounded-lg shadow-lg 
               hover:bg-green-600/80 transition duration-200 backdrop-blur-sm
               w-auto min-w-fit"
        onclick="location.href='glossary.html'"
      >
        ç”¨èªè§£èª¬
      </button>

      <!-- ä¸²ã‚’é£›ã°ã™ãƒœã‚¿ãƒ³ -->
      <button
        id="moveButton"
        class="px-6 py-2 bg-red-500/80 text-white font-semibold rounded-lg shadow-lg 
               hover:bg-red-600/80 transition duration-200 backdrop-blur-sm
               w-auto min-w-fit"
      >
        ä¸²ã‚’é£›ã°ã™
      </button>
    </div>
  </main>

  <!-- ===========================
        ãƒ•ãƒƒã‚¿ãƒ¼
  ============================ -->
  <footer class="bg-amber-300/80 w-full shadow-inner p-1 fixed bottom-0">
    <p class="text-center m-1 text-sm sm:text-base">kabab-case-game@NOA</p>
  </footer>

  <!-- ===========================
        ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
  ============================ -->
  <script>
    // -------------------------------------
    // å®šæ•°ãƒ»å¤‰æ•°ã®åˆæœŸè¨­å®š
    // -------------------------------------
    const words = [
      // ã‚±ãƒãƒ–ç´ æ
      "chicken meat", "cow meat", "sheep meat", "Turkey Meat", "Pita Bread",

      // ã‚¹ãƒãƒ¼ã‚¯ç³»ï¼ˆsnake_caseï¼‰
      "anaconda_serpent",

      // ã‚¢ãƒƒãƒ‘ãƒ¼ã‚¹ãƒãƒ¼ã‚¯ç³»ï¼ˆUPPER_SNAKE_CASEï¼‰
      "ANACONDA_SERPENT",

      // ã‚­ãƒ£ãƒ¡ãƒ«ç³»ï¼ˆlowerCamelCaseï¼‰
      "dromedaryCamel",

      // ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ç³»ï¼ˆPascalCaseï¼‰
      "BactrianCamel",

      // ãƒãƒ³ã‚¬ãƒªã‚¢ãƒ³è¨˜æ³•
      "pListData", "iCount",

      // ãƒ‰ãƒƒãƒˆè¨˜æ³•
      "polka.dot", "pin.dot",
    ];

    const wordElements = [];
    const results = [];

    const gameArea = document.getElementById("gameArea");
    const skewer = document.getElementById("skewer");

    let skewerLeft = 0;
    let flying = false;

    // -------------------------------------
    // ä¸²ã®åˆæœŸä½ç½®è¨­å®šï¼ˆå³ç«¯ã«é…ç½®ï¼‰
    // -------------------------------------
    function setSkewerInitialPosition() {
      const skewerWidth = skewer.offsetWidth || 150;
      skewerLeft = window.innerWidth - skewerWidth;
      skewer.style.left = skewerLeft + "px";
      skewer.style.display = "block";
    }

    setSkewerInitialPosition();

    // -------------------------------------
    // å˜èªç”Ÿæˆï¼ˆãƒ©ãƒ³ãƒ€ãƒ ã‚µã‚¤ã‚ºãƒ»é€Ÿåº¦ãƒ»ä½ç½®ï¼‰
    // -------------------------------------
    function createWord() {
      const word = document.createElement("div");
      word.classList.add("word");
      word.textContent = words[Math.floor(Math.random() * words.length)];

      // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºï¼ˆ1.5ã€œ2.5remï¼‰
      const fontSize = 1.5 + Math.random();
      word.style.fontSize = fontSize + "rem";

      gameArea.appendChild(word);

      // ãƒ©ãƒ³ãƒ€ãƒ ãªå·¦å³ä½ç½®ã¨è½ä¸‹é€Ÿåº¦
      const wordWidth = word.offsetWidth;
      const margin = 10;
      const minLeft = 10;
      const maxLeft = skewerLeft - wordWidth - margin;
      if (window.innerWidth <= 640) { // å°‘ã—ã‚¹ãƒãƒ›å¯¾å¿œ
        word.style.left = minLeft + Math.random() * (maxLeft - minLeft) - 100 + "px";
      } else {
        word.style.left = minLeft + Math.random() * (maxLeft - minLeft) + "px";
      }
      word.style.top = "0px";
      word.dataset.speed = 0.5 + Math.random() * 1.5;

      wordElements.push(word);
    }

    // -------------------------------------
    // è¡çªåˆ¤å®š
    // -------------------------------------
    function hitCheckSkewer(skewerRect, wordRect) {
      const tolerance = 5;
      const skewerLeftX = skewerRect.left;
      const skewerRightX = skewerRect.right;
      const skewerCenterY = skewerRect.top + skewerRect.height / 2;

      const horizontalHit =
        skewerLeftX <= wordRect.right + tolerance &&
        skewerRightX >= wordRect.right - tolerance;

      const verticalHit =
        skewerCenterY >= wordRect.top &&
        skewerCenterY <= wordRect.bottom;

      return horizontalHit && verticalHit;
    }

    // -------------------------------------
    // å˜èªã®è½ä¸‹ãƒ»è¡çªæ¤œå‡º
    // -------------------------------------
    function updateWords() {
      wordElements.forEach((word, index) => {
        const speed = parseFloat(word.dataset.speed);
        word.style.top = parseFloat(word.style.top) + speed + "px";

        const wordRect = word.getBoundingClientRect();
        const skewerRect = skewer.getBoundingClientRect();

        // è¡çªæ™‚ã®å‡¦ç†
        if (hitCheckSkewer(skewerRect, wordRect)) {
          const wordText = word.textContent || "";
          const skewerCenterY = skewerRect.top + skewerRect.height / 2;
          const hitPercent = ((skewerCenterY - wordRect.top) / wordRect.height) * 100;
          const clampedHitPercent = Math.min(Math.max(hitPercent, 0), 100).toFixed(1);

          results.push({ word: wordText, hitPercent: clampedHitPercent });
          console.log("è¡çªã—ã¾ã—ãŸ:", wordText, clampedHitPercent);

          word.remove();
          wordElements.splice(index, 1);

          setTimeout(() => {
            window.location.href = `result.html?word=${encodeURIComponent(wordText)}&hitPercent=${clampedHitPercent}`;
          }, 100);
        }

        // ç”»é¢å¤–ã«è½ä¸‹ã—ãŸã‚‰å‰Šé™¤
        if (parseFloat(word.style.top) > window.innerHeight) {
          word.remove();
          wordElements.splice(index, 1);
        }
      });
    }

    // -------------------------------------
    // ä¸²ã®ç§»å‹•å‡¦ç†
    // -------------------------------------
    document.getElementById("moveButton").addEventListener("click", () => {
      if (flying) return;
      flying = true;
      const speed = 40;

      function fly() {
        skewerLeft -= speed;
        if (skewerLeft < 0) skewerLeft = 0;
        skewer.style.left = skewerLeft + "px";

        if (skewerLeft > 0) {
          requestAnimationFrame(fly);
        } else {
          skewer.style.display = "none";
          setTimeout(() => {
            setSkewerInitialPosition();
            flying = false;
          }, 300);
        }
      }

      requestAnimationFrame(fly);
    });

    // -------------------------------------
    // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã«ä¸²ã‚’å†é…ç½®
    // -------------------------------------
    window.addEventListener('resize', () => {
      if (!flying) {
        setSkewerInitialPosition();
      }
    });

    // -------------------------------------
    // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
    // -------------------------------------
    setInterval(() => {
      if (Math.random() < 0.03) createWord();
      updateWords();
    }, 16);
  </script>
</body>
</html>