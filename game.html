<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ケバブケースゲーム</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- フォント追加 -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'メイリオ', 'Meiryo', 'Hiragino Kaku Gothic ProN', sans-serif;
      overflow: hidden;
    }
    .word {
      position: absolute;
      font-weight: bold;
      user-select: none;
      font-family: 'Baloo 2', 'Zen Maru Gothic', 'Meiryo', sans-serif;
    }
    /* スマホ用（画面幅 640px 以下） */
    @media screen and (max-width: 640px) {
      .word {
        font-size: 1.5rem !important; /* 強制的に小さめに */
      }
    }
    #skewer {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      max-width: 150px;
      max-height: 150px;
      object-fit: contain;
      animation: kababRedGlow 2s linear infinite;
      transition: filter 0.3s ease;
    }

    @keyframes kababRedGlow {
      0% {
        filter: drop-shadow(0 0 6px rgba(255, 80, 80, 0.9))
                drop-shadow(0 0 12px rgba(255, 60, 60, 0.8))
                drop-shadow(0 0 24px rgba(255, 40, 40, 0.7));
      }
      50% {
        filter: drop-shadow(0 0 10px rgba(255, 120, 120, 1))
                drop-shadow(0 0 20px rgba(255, 100, 100, 0.9))
                drop-shadow(0 0 40px rgba(255, 80, 80, 0.8));
      }
      100% {
        filter: drop-shadow(0 0 6px rgba(255, 80, 80, 0.9))
                drop-shadow(0 0 12px rgba(255, 60, 60, 0.8))
                drop-shadow(0 0 24px rgba(255, 40, 40, 0.7));
      }
    }

  </style>
</head>
<body class="relative h-screen bg-gray-100 bg-[url('image/target_cut.png')] bg-center bg-cover">

  <!-- ヘッダー -->
  <header class="bg-amber-300/80 w-full shadow-md p-1 sticky top-0">
    <h1 class="text-center text-lg m-2">
      ゲーム：落ちてくる言葉に串をさしてケバブケース作れ！
    </h1>
  </header>

  <!-- メインコンテンツ -->
  <main id="gameArea" class="relative w-full" style="height: calc(100vh - 60px - 60px);">

    <!-- 串 -->
    <img id="skewer" src="image/skewer.png" alt="skewer">
    
    <!-- 共通ボタンテンプレート（フッター上固定＋レスポンシブ） -->
    <div
      class="fixed bottom-20 left-1/2 transform -translate-x-1/2 
            grid justify-center gap-3 z-30
            sm:flex sm:flex-nowrap sm:justify-center"
      style="grid-template-columns: repeat(2, max-content);"
    >
      <!-- ホームボタン -->
      <button
        class="px-6 py-2 bg-blue-500/80 text-white font-semibold rounded-lg shadow-lg 
              hover:bg-blue-600/80 transition duration-200 backdrop-blur-sm
              w-auto min-w-fit"
        onclick="location.href='index.html'"
      >
        ホーム
      </button>

      <!-- 操作説明へ -->
      <button
        class="px-6 py-2 bg-green-500/80 text-white font-semibold rounded-lg shadow-lg 
              hover:bg-green-600/80 transition duration-200 backdrop-blur-sm
              w-auto min-w-fit"
        onclick="location.href='rules.html'"
      >
        ルール・操作説明
      </button>

      <!-- 用語解説 -->
      <button
        onclick="location.href='glossary.html'"
        class="px-6 py-2 bg-green-500/80 text-white font-semibold rounded-lg shadow-lg 
              hover:bg-green-600/80 transition duration-200 backdrop-blur-sm
              w-auto min-w-fit"
      >
        用語解説
      </button>

      <!-- 串を飛ばすボタン -->
      <button
        class="px-6 py-2 bg-red-500/80 text-white font-semibold rounded-lg shadow-lg 
              hover:bg-red-600/80 transition duration-200 backdrop-blur-sm
              w-auto min-w-fit"
        id="moveButton"
      >
        串を飛ばす
      </button>
    </div>
  </main>

  <!-- フッター -->
  <footer class="bg-amber-300/80 w-full shadow-inner p-1 fixed bottom-0">
    <p class="text-center m-2">@NOA</p>
  </footer>

  <script>
    const words = ["apple ringo", "banana.test", "sakuraCherry", "date", "fig", "grape"];
    const wordElements = [];
    const results = [];

    const gameArea = document.getElementById("gameArea");
    const skewer = document.getElementById("skewer");
    let skewerLeft = 0;
    let flying = false;

    // ---------------------------
    // 串の初期位置設定（右端がウィンドウ右端に接触）
    // ---------------------------
    function setSkewerInitialPosition() {
      const skewerWidth = skewer.offsetWidth || 150;
      skewerLeft = window.innerWidth - skewerWidth;
      skewer.style.left = skewerLeft + "px";
      skewer.style.display = "block";
    }

    setSkewerInitialPosition();

    // ---------------------------
    // 単語生成（ランダムサイズ）
    // ---------------------------
    function createWord() {
      const word = document.createElement("div");
      word.classList.add("word");
      word.textContent = words[Math.floor(Math.random() * words.length)];

      // ランダムサイズ（2rem～3rem）
      const fontSize = 1.5 + Math.random(); // 2～3rem
      word.style.fontSize = fontSize + "rem";

      gameArea.appendChild(word);

      const wordWidth = word.offsetWidth;
      const margin = 10;
      const minLeft = 10;
      const maxLeft = skewerLeft - wordWidth - margin;
      word.style.left = minLeft + Math.random() * (maxLeft - minLeft) + "px";
      word.style.top = "0px";
      word.dataset.speed = 0.5 + Math.random() * 1.5;

      wordElements.push(word);
    }

    // ---------------------------
    // 衝突判定
    // ---------------------------
    function hitCheckSkewer(skewerRect, wordRect) {
      const tolerance = 5;
      const skewerLeftX = skewerRect.left;
      const skewerRightX = skewerRect.right;
      const skewerCenterY = skewerRect.top + skewerRect.height / 2;

      const horizontalHit = (skewerLeftX <= wordRect.right + tolerance) &&
                            (skewerRightX >= wordRect.right - tolerance);
      const verticalHit = (skewerCenterY >= wordRect.top) &&
                          (skewerCenterY <= wordRect.bottom);
      return horizontalHit && verticalHit;
    }

    // ---------------------------
    // 単語落下＆衝突判定
    // ---------------------------
    function updateWords() {
      wordElements.forEach((word, index) => {
        const speed = parseFloat(word.dataset.speed);
        word.style.top = parseFloat(word.style.top) + speed + "px";

        const wordRect = word.getBoundingClientRect();
        const skewerRect = skewer.getBoundingClientRect();

        if (hitCheckSkewer(skewerRect, wordRect)) {
          const wordText = word.textContent || "";
          const skewerCenterY = skewerRect.top + skewerRect.height / 2;
          const hitPercent = ((skewerCenterY - wordRect.top) / wordRect.height) * 100;
          const clampedHitPercent = Math.min(Math.max(hitPercent, 0), 100).toFixed(1);

          results.push({ word: wordText, hitPercent: clampedHitPercent });
          console.log("衝突しました:", wordText, clampedHitPercent);

          word.remove();
          wordElements.splice(index, 1);

          setTimeout(() => {
            window.location.href = `result.html?word=${encodeURIComponent(wordText)}&hitPercent=${clampedHitPercent}`;
          }, 100);
        }

        if (parseFloat(word.style.top) > window.innerHeight) {
          word.remove();
          wordElements.splice(index, 1);
        }
      });
    }

    // ---------------------------
    // 串移動
    // ---------------------------
    document.getElementById("moveButton").addEventListener("click", () => {
      if (flying) return;
      flying = true;
      const speed = 40;

      function fly() {
        skewerLeft -= speed;
        if (skewerLeft < 0) skewerLeft = 0;
        skewer.style.left = skewerLeft + "px";

        if (skewerLeft > 0) {
          requestAnimationFrame(fly);
        } else {
          skewer.style.display = "none";
          setTimeout(() => {
            setSkewerInitialPosition();
            flying = false;
          }, 300);
        }
      }

      requestAnimationFrame(fly);
    });

    // ---------------------------
    // ウィンドウリサイズ時
    // ---------------------------
    window.addEventListener('resize', () => {
      if (!flying) {
        setSkewerInitialPosition();
      }
    });

    // ---------------------------
    // ゲームループ
    // ---------------------------
    setInterval(() => {
      if (Math.random() < 0.03) createWord();
      updateWords();
    }, 16);

  </script>
</body>
</html>